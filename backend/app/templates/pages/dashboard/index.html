{% extends "base.html" %}
{% from "macros/components.html" import stat_card, card, icon %}

{% block title %}Dashboard - Enclava{% endblock %}

{% block content %}
<div class="space-y-8">
  <!-- Header -->
  <div>
    <h1 class="text-3xl font-display font-bold">Dashboard</h1>
    <p class="text-muted-foreground mt-1">Welcome back, {{ user.email }}</p>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    {{ stat_card(
      label='Active API Keys',
      value=stats.active_api_keys,
      icon='<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>'
    ) }}

    {{ stat_card(
      label='Extract Jobs (24h)',
      value=stats.recent_extract_jobs,
      icon='<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>'
    ) }}

    {{ stat_card(
      label='Total Extract Jobs',
      value=stats.total_extract_jobs,
      icon='<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>'
    ) }}

    {% set budget_percentage = (stats.budget_used / stats.budget_total * 100) | round | int if stats.budget_total > 0 else 0 %}
    {{ stat_card(
      label='Budget Usage',
      value=budget_percentage ~ '%',
      change='$' ~ stats.budget_used | round(2) ~ ' / $' ~ stats.budget_total | round(2),
      icon='<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>'
    ) }}
  </div>

  <!-- Quick Actions -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Extract Module Card -->
    {% call card(title='Extract Documents', description='Process documents with AI-powered extraction') %}
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 rounded-full bg-primary/10 text-primary">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        <div>
          <p class="font-medium">Extract Module</p>
          <p class="text-sm text-muted-foreground">Enabled</p>
        </div>
      </div>
      <a href="/extract" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4">
        Open
      </a>
    </div>
    {% endcall %}

    <!-- API Endpoint Card -->
    {% call card(title='API Endpoint', description='Use the REST API for integrations') %}
    <div class="space-y-3">
      <div class="flex items-center gap-2 p-3 bg-muted rounded-md font-mono text-sm">
        <span class="text-muted-foreground flex-1 truncate" id="api-endpoint">{{ request.url.scheme }}://{{ request.url.netloc }}/api/v1</span>
        <button
          type="button"
          onclick="copyToClipboard(document.getElementById('api-endpoint').textContent, this)"
          class="shrink-0 p-1.5 rounded hover:bg-accent"
          title="Copy to clipboard"
        >
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
          </svg>
        </button>
      </div>
      <div class="flex items-center gap-2">
        <a href="/api-keys" class="text-sm text-primary hover:underline">Manage API Keys</a>
        <span class="text-muted-foreground">|</span>
        <a href="/api/v1/docs" target="_blank" class="text-sm text-primary hover:underline">API Documentation</a>
      </div>
    </div>
    {% endcall %}
  </div>

  <!-- Quick Links -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <a href="/extract" class="p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors group">
      <svg class="h-8 w-8 text-muted-foreground group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <p class="font-medium mt-2">Extract</p>
      <p class="text-sm text-muted-foreground">Process documents</p>
    </a>

    <a href="/api-keys" class="p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors group">
      <svg class="h-8 w-8 text-muted-foreground group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
      </svg>
      <p class="font-medium mt-2">API Keys</p>
      <p class="text-sm text-muted-foreground">Manage access</p>
    </a>

    <a href="/budgets" class="p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors group">
      <svg class="h-8 w-8 text-muted-foreground group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
      </svg>
      <p class="font-medium mt-2">Budgets</p>
      <p class="text-sm text-muted-foreground">Track spending</p>
    </a>

    <a href="/analytics" class="p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors group">
      <svg class="h-8 w-8 text-muted-foreground group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
      </svg>
      <p class="font-medium mt-2">Analytics</p>
      <p class="text-sm text-muted-foreground">View usage</p>
    </a>
  </div>
</div>
{% endblock %}
